#!/bin/bash

RED='\e[41m'
BLUE='\e[44m'
ORANGE='\e[46m'
NC='\e[0m'
if [ $(cat /proc/1/comm) = "systemd" ]; then
	systemctl status NetworkManager.service | grep -q " active " && netcommand="nmtui"
	systemctl status Netctl.service | grep -q " active " && netcommand="sudo wifi-menu"
else
	rc-status | grep -q "NetworkManager" && netcommand="nmtui"
	rc-status | grep -q "Netctl" && netcommand="sudo wifi-menu"
fi
function cli_filemanager {
	if [ -e /usr/bin/ranger ]; then
		ranger
	elif [ -e /usr/bin/mc ]; then
		mc
	else
		echo "Installing ranger to manage files"
		if [ - e /var/lib/pacman/db.lck ]; then 
			echo "No cli filemanager is installed and pacman seems to be in use"
		else 
			sudo pacman -Sy ranger && ranger
		fi
	fi
}

function file_finder {
	if [ -e /usr/bin/rifle ]; then
		rifle $(find -type f | fzf -e --reverse)
	else
		echo "Installing ranger to get a rifle"
		if [ - e /var/lib/pacman/db.lck ]; then 
			echo "Rifle is not installed and pacman seems to be in use"
		else 
			sudo pacman -Sy ranger && rifle $(find -type f | fzf -e --reverse)
		fi
	fi
}

function manage_time {
	if [ -e /usr/bin/timeset ]; then
		sudo timeset
	else
		echo "Installing timeset to manage time"
		if [ -e /var/lib/pacman/db.lck ]; then 
			echo "Timeset is not installed and pacman seems to be in use"
		else 
			sudo pacman -Sy timeset && sudo timeset
		fi
	fi
}

function cli_browser {
	if [ -e /usr/bin/elinks ]; then
		elinks
	elif [ -e /usr/bin/w3m ]; then
		w3m
	elif [ -e /usr/bin/links ]; then
		links
	elif [ -e /usr/bin/lynx ]; then
		lynx
	else
		if [ -e /var/lib/pacman/db.lck ]; then 
			echo "no cli browser installed and pacman seems to be in use"
		else 
			sudo pacman -Sy elinks && elinks
		fi
	fi
}
function taskmanager {
	if [ -e /usr/bin/htop ]; then
		htop
	else
		echo "Installing htop to manage tasks"
		sudo pacman -Sy htop && htop
	fi
}
function display_settings {
	if [ -e /usr/bin/brandr ]; then
		brandr
	else
		echo "Installing brandr to manage display"
		if [ -e /var/lib/pacman/db.lck ]; then 
			echo "Brandr is not installed and pacman seems to be in use"
		else 
			sudo pacman -Sy brandr && brandr
		fi
	fi
}
function hardware_settings {
	if [ -e /usr/bin/mhwd-tui ]; then
		mhwd-tui
	else
		echo "Installing mhwd-tui to manage kernels and drivers"
		if [ -e /var/lib/pacman/db.lck ]; then 
			echo "Mhwd-tui is not installed and pacman seems to be in use"
		else 
			sudo pacman -Sy mhwd-tui && mhwd-tui
		fi
	fi
}

function init_settings {
if [ $(cat /proc/1/comm) = "systemd" ]; then
	initmenu
else
	initmenu-openrc
fi
}

    while true; do
    clear
    echo ""
    echo -e "                       ::Main menu::  "
    echo -e " ┌─────────────────────────────────────────────────────────────┐"
    echo -e " │    1   Kernels and drivers          2   Display             │"
    echo -e " │    3   Printers                     4   Appearance          │"
    echo -e " │    5   Package manager              6   Network             │"    
    echo -e " │    7   Sound                        8   Configuration       │"
    echo -e " │    9   Time settings                T   Taskmanager         │"
    echo -e " │    F   File Manager                 B   Browser             │"
    echo -e " │    S   Search                       I   Init-system         │"
    echo -e " └─────────────────────────────────────────────────────────────┘"
    echo -e "        Select an item        -        0   Exit "
    echo ""
    read -s -n1 choix
    case $choix in
        1)
            echo
            hardware_settings
            echo ""
            ;;
        2)
            echo
            display_settings
            echo ""
            ;;
        3)
            echo
            bcups
            echo ""
            ;;
        4)
            echo
            appearance-menu
            echo ""
            ;;
        5)
            echo
            pacli
            echo ""
            ;;
        6)
            echo
            $netcommand
            echo ""
            ;;
        7)
            echo
            alsamixer
            echo ""
            ;;
        8)
            echo
            system-settings
            echo ""
            ;;
        9)
            echo
            manage_time
            echo ""
            ;;
        t|T)
            echo
            taskmanager
            echo ""
            ;;
        f|F)
            echo
            cli_filemanager
            echo ""
            ;;
        b|B)
            echo
            cli_browser
            echo ""
            ;;
        s|S)
            echo
            file_finder
            echo ""
            ;;
        i|I)
            echo
            init_settings
            echo ""
            ;;
        0)
            clear && exit
            read
            ;;
        *)
            echo -e "$RED Wrong option $NC"
            echo "Wait and try again later..."
            echo ""
            sleep 3
            clear
            ;;
    esac
    done
fi
